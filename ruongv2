local TweenService = game:GetService("TweenService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local root = character:WaitForChild("HumanoidRootPart")
local speed = 350
_G.AutoCollectChest = true
local humanoid = character:WaitForChild("Humanoid")
local function flyTo(targetPos)
    if not root then return end

    local human = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
    if human then
        human.PlatformStand = true -- Giúp không bị animation kéo lại
        human:ChangeState(Enum.HumanoidStateType.Jumping)
    end
    local platform = Instance.new("Part")
    platform.Size = Vector3.new(1, 1, 1)
    platform.Transparency = 0
    platform.Anchored = true
    platform.CanCollide = false
    platform.Parent = workspace
    local startPos = root.Position
    platform.CFrame = CFrame.new(startPos.X, startPos.Y - 3, startPos.Z)
    local distance = (targetPos - startPos).Magnitude
    local time = distance / speed
    local tween = TweenService:Create(
        platform,
        TweenInfo.new(time, Enum.EasingStyle.Linear),
        {CFrame = CFrame.new(targetPos.X, targetPos.Y - 3, targetPos.Z)}
    )
    local connection = nil
    connection = RunService.RenderStepped:Connect(function()
        if not platform or not root then
            connection:Disconnect()
            return
        end
        root.CFrame = platform.CFrame + Vector3.new(0, 3, 0)
    end)
    tween:Play()
    tween.Completed:Wait()
    if connection then connection:Disconnect() end
    platform:Destroy()
    if human then human.PlatformStand = false end
end
local function ruong()
    while wait() do
        local char = player.Character or player.CharacterAdded:Wait()
        local pos = char:GetPivot().Position
        local chests = game:GetService("CollectionService"):GetTagged("_ChestTagged")
        local minDist, closest = math.huge, nil
        for i = 1, #chests do
            local chest = chests[i]
            local dist = (chest:GetPivot().Position - pos).Magnitude
            if not chest:GetAttribute("IsDisabled") and dist < minDist then
                minDist, closest = dist, chest
            end
        end
        if closest then
            flyTo(closest:GetPivot().Position)
        end
    end
end
task.spawn(ruong)
